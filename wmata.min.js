var interval=3000;var elapsed_threshold=10;var l_cid=[];var test="OTNlOGRmMDQ2N2E0NGFmYmIxMTA0Y2VlYWFjZTBhNDM=";function clearTracks(){var a,b,e,d;while(l_cid.length>0){b=l_cid.pop();a=document.getElementsByClassName("cid"+((b.CircuitId).toString()));a[0].innerHTML=b.Char;a[0].classList.remove(b.LineCode);d=document.getElementsByClassName("cmt"+b.CircuitId);if(d.length>0){d[0].innerHTML=""}}}function makeTimeString(a){if(a<60){return a+" s"}else{if(a<3600){return Math.round(a/60)+" m"}else{return Math.round(a/3600)+" h"}}}function processTrainData(d){var c,a=d.TrainPositions.length;var e,b;clearTracks();for(c=0;c<a;++c){e=d.TrainPositions[c];b=document.getElementsByClassName("cid"+((e.CircuitId).toString()));comment=document.getElementsByClassName("cmt"+((e.CircuitId).toString()));if(b.length>0){l_cid.push({CircuitId:e.CircuitId,LineCode:e.LineCode,Char:b[0].innerHTML});b[0].innerHTML=(e.ServiceType=="Normal")?e.CarCount:"?";b[0].title="train #"+e.TrainId+" dir="+e.DirectionNum+" dest="+e.DestinationStationCode+" cars="+e.CarCount;if(comment.length>0){comment[0].innerHTML=(e.SecondsAtLocation>elapsed_threshold)?makeTimeString(e.SecondsAtLocation):" "}b[0].classList.add("visited");b[0].classList.add(e.LineCode)}}}function getData(){var a={api_key:atob(test),};$.ajax({url:"https://api.wmata.com/TrainPositions/TrainPositions?contentType={contentType}&"+$.param(a),type:"GET",}).done(function(b){processTrainData(b)}).fail(function(){console.error("unable to access data from WMATA")})}document.addEventListener("keydown",function(a){if(a.keyCode==68){$(".debug").toggle()}});getData();var intervalID=setInterval(getData,interval);